#!/usr/bin/env python3# -*- coding: utf-8 -*-# TODO_list:# TODO more export options (.csv)?# librariesfrom modules import config_modimport tkinter as tkimport openpyxlimport pathlib# save selected talliesdef save_to_xlsx(sel_tally):        config_mod.plot_settings["export_dir_path"] = pathlib.Path(tk.filedialog.asksaveasfilename(title='Choose directory and file name without an extension:', initialdir=config_mod.plot_settings["export_dir_path"], defaultextension=".xlsx"))    # create a new directory if it doesn't exist    """    result_path = config_mod.plot_settings["work_dir_path"] / 'export'    result_path.mkdir(parents=True, exist_ok=True)    """    wb = openpyxl.Workbook()    del wb['Sheet']    ii = 0    # create new sheets    for tally in sel_tally:        # solve the problem with too long output+tally names        if len(tally) > 31:            ii += 1            tally_m = tally[len(tally)-31:]        else:            tally_m = tally                wb.create_sheet(tally_m)        wb[tally_m].append(['Filename', tally])        wb[tally_m].append(['Tally number', config_mod.tallies[tally][0]])        wb[tally_m].append(['Tally type', config_mod.tallies[tally][1]])        wb[tally_m].append(['Tally particle', config_mod.tallies[tally][2]])        wb[tally_m].append(['Comment', config_mod.tallies[tally][8]])                wb[tally_m].append(['energy', 'flux', 'flux normalized per 1 MeV','error'])        for i in range(0, len(config_mod.tallies[tally][3])):            wb[tally_m].append((config_mod.tallies[tally][3][i], config_mod.tallies[tally][4][i], config_mod.tallies[tally][7][i], config_mod.tallies[tally][5][i]))    wb.save(filename= str(config_mod.plot_settings["export_dir_path"]))    if ii > 0:        tk.messagebox.showerror('Output error', "A total of " + str(ii) + " names are longer than " +                                '31 characters. There is limit of XLSX sheet name. Tally name was modified, '                                'the first characters were deleted to prevent duplicity in naming.')    else:        tk.messagebox.showinfo(title='Export to XLSX', message='Tally export has been completed.')